id: bitrix-csrf-vulnerabilities

info:
  name: Bitrix CSRF (Cross-Site Request Forgery) Vulnerabilities
  author: clevergod
  severity: medium
  description: |
    Проверка CSRF уязвимостей в Bitrix CMS через различные эндпоинты
  tags: bitrix,csrf,cross-site-request-forgery

requests:
  # CSRF в компоненте vote без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/vote.result.new/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      VOTE_ID=1&VOTE_ANSWER_ID=1
    matchers:
      - type: word
        name: csrf-vote
        words:
          - "success"
          - "vote"

  # CSRF в компоненте forum без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/forum.topic.list/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      FID=1&TOPIC_ID=1
    matchers:
      - type: word
        name: csrf-forum
        words:
          - "success"
          - "forum"

  # CSRF в компоненте blog без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/blog.post.list/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      BLOG_ID=1&POST_ID=1
    matchers:
      - type: word
        name: csrf-blog
        words:
          - "success"
          - "blog"

  # CSRF в компоненте catalog без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/catalog.section.list/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      IBLOCK_ID=1&SECTION_ID=1
    matchers:
      - type: word
        name: csrf-catalog
        words:
          - "success"
          - "catalog"

  # CSRF в компоненте sale без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/sale.basket.basket/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      PRODUCT_ID=1&QUANTITY=1
    matchers:
      - type: word
        name: csrf-sale
        words:
          - "success"
          - "basket"

  # CSRF в html_editor_action без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/html_editor_action.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=save_file&path=/upload/test.txt&content=test
    matchers:
      - type: word
        name: csrf-html-editor
        words:
          - "success"

  # CSRF в site_checker без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/site_checker.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=check&site=http://example.com
    matchers:
      - type: word
        name: csrf-site-checker
        words:
          - "success"
          - "check"

  # CSRF в WebDAV без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/webdav.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&path=/upload/test.txt&content=test
    matchers:
      - type: word
        name: csrf-webdav
        words:
          - "success"
          - "upload"

  # CSRF в updater без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/modules/updater.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=update&module=test
    matchers:
      - type: word
        name: csrf-updater
        words:
          - "success"
          - "update"

  # CSRF в composite_data без токена
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/composite_data.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=save&data=test
    matchers:
      - type: word
        name: csrf-composite
        words:
          - "success"
          - "composite" 