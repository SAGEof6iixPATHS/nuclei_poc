id: bitrix-info-disclosure-precise

info:
  name: Bitrix Information Disclosure Precise Check
  author: clevergod
  severity: medium
  description: |
    Точная проверка утечек информации в Bitrix CMS с исключением HTML-страниц
  tags: bitrix,info-disclosure,information-leak,debug

requests:
  # Debug информация (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/tools/show_include_exec_time.php"
    matchers:
      - type: word
        name: debug-exec-time
        words:
          - "Include Time"
          - "execution time"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Конфигурационные файлы (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/.settings.php"
      - "{{BaseURL}}/bitrix/.settings.php.bak"
      - "{{BaseURL}}/.env"
      - "{{BaseURL}}/.env.bak"
    matchers:
      - type: word
        name: config-files
        words:
          - "DBHost"
          - "DBLogin"
          - "DBPassword"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Логи (только если это реальные лог файлы)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/modules/updater.log"
    matchers:
      - type: word
        name: updater-log
        words:
          - "UpdateSystem"
          - "UpdateSystem::"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'
          - '!contains(body, "form_auth")'

  # Директории (только если это реальные директории)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/logs/"
      - "{{BaseURL}}/bitrix/backup/"
    matchers:
      - type: word
        name: directory-listing
        words:
          - "Index of"
          - "Directory listing"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Временные файлы (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/cache/"
      - "{{BaseURL}}/bitrix/tmp/"
      - "{{BaseURL}}/bitrix/managed_cache/"
    matchers:
      - type: word
        name: temp-files
        words:
          - "cache"
          - "tmp"
          - "managed_cache"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Резервные копии (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/.htaccess.bak"
      - "{{BaseURL}}/bitrix/.htaccess.backup"
      - "{{BaseURL}}/.htaccess.bak"
      - "{{BaseURL}}/.htaccess.backup"
    matchers:
      - type: word
        name: backup-files
        words:
          - "RewriteEngine"
          - "DirectoryIndex"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Компоненты (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/vote.result.new/templates/.default/template.php"
      - "{{BaseURL}}/bitrix/components/bitrix/forum.topic.list/templates/.default/template.php"
      - "{{BaseURL}}/bitrix/components/bitrix/blog.post.list/templates/.default/template.php"
    matchers:
      - type: word
        name: component-templates
        words:
          - "<?php"
          - "template"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Модули (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/modules/vote/install/index.php"
      - "{{BaseURL}}/bitrix/modules/forum/install/index.php"
      - "{{BaseURL}}/bitrix/modules/blog/install/index.php"
    matchers:
      - type: word
        name: module-install
        words:
          - "install"
          - "module"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")'

  # Админка (только если это не HTML)
  - method: GET
    path:
      - "{{BaseURL}}/bitrix/admin/"
      - "{{BaseURL}}/bitrix/admin/index.php"
    matchers:
      - type: word
        name: admin-panel
        words:
          - "admin"
          - "Bitrix"
        condition: and
      - type: status
        status:
          - 200
      - type: dsl
        dsl:
          - 'status_code == 200'
          - '!contains(body, "<html")'
          - '!contains(body, "<!DOCTYPE")'
          - '!contains(body, "DOCTYPE")'
          - '!contains(body, "xmlns=")' 