
id: aadhar-pan-scanner-spaces

info:
  name: Indian Identity Cards Detection (Aadhar with spaces & PAN)
  author: gigachad80
  severity: critical
  description: |
    Comprehensive detection template for exposed Indian identity documents including:
    - Aadhar cards (with and without spaces)
    - PAN cards
    - Covers web pages, APIs, file endpoints, and error pages
  reference:
    - https://uidai.gov.in/
    - https://www.incometax.gov.in/
  classification:
    cve-id: N/A
    cwe-id: CWE-200
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
  metadata:
    verified: true
    max-request: 25
    shodan-query: N/A
  tags: exposure,aadhar,aadhaar,pan,pii,india,sensitive-data,identity,comprehensive

http:
  - method: GET
    path:
      # Standard web pages
      - "{{BaseURL}}"
      - "{{BaseURL}}/"
      - "{{BaseURL}}/index"
      - "{{BaseURL}}/home"
      
      # Authentication & User pages
      - "{{BaseURL}}/login"
      - "{{BaseURL}}/register"
      - "{{BaseURL}}/profile"
      - "{{BaseURL}}/account"
      - "{{BaseURL}}/user"
      - "{{BaseURL}}/users"
      - "{{BaseURL}}/dashboard"
      - "{{BaseURL}}/admin"
      
      # KYC & Document pages
      - "{{BaseURL}}/kyc"
      - "{{BaseURL}}/verification"
      - "{{BaseURL}}/documents"
      - "{{BaseURL}}/verify"
      - "{{BaseURL}}/onboarding"
      
      # API endpoints
      - "{{BaseURL}}/api"
      - "{{BaseURL}}/api/users"
      - "{{BaseURL}}/api/user"
      - "{{BaseURL}}/api/profile"
      - "{{BaseURL}}/api/customers"
      - "{{BaseURL}}/api/kyc"
      - "{{BaseURL}}/api/verification"
      - "{{BaseURL}}/api/documents"
      - "{{BaseURL}}/rest/users"
      - "{{BaseURL}}/v1/users"
      - "{{BaseURL}}/v2/users"
      
      # File & Upload endpoints
      - "{{BaseURL}}/uploads"
      - "{{BaseURL}}/files"
      - "{{BaseURL}}/media"
      - "{{BaseURL}}/static/uploads"
      - "{{BaseURL}}/assets/uploads"
      - "{{BaseURL}}/public/uploads"
      - "{{BaseURL}}/storage"
      - "{{BaseURL}}/download"
      - "{{BaseURL}}/attachment"
      
      # Debug & Error pages
      - "{{BaseURL}}/debug"
      - "{{BaseURL}}/error"
      - "{{BaseURL}}/test"
      - "{{BaseURL}}/dev"
      - "{{BaseURL}}/logs"
      - "{{BaseURL}}/trace"
      - "{{BaseURL}}/exception"

    headers:
      Accept: "*/*"
      User-Agent: "Mozilla/5.0 (compatible; SecurityScanner/1.0)"

    matchers-condition: and
    matchers:
      # Primary regex matcher for all identity patterns
      - type: regex
        name: identity-documents
        regex:
          # Aadhar with spaces: XXXX XXXX XXXX
          - "[2-9]{1}[0-9]{3}\\s[0-9]{4}\\s[0-9]{4}"
          # Aadhar without spaces: XXXXXXXXXXXX
          - "[2-9]{1}[0-9]{11}"
          # PAN card: ABCDE1234F
          - "[A-Z]{5}[0-9]{4}[A-Z]{1}"
          # Contextual patterns with keywords
          - "(?i)(aadhar|aadhaar|uid|unique.?id).{0,50}[2-9]{1}[0-9]{3}\\s?[0-9]{4}\\s?[0-9]{4}"
          - "(?i)(pan.?card|pan.?number|permanent.?account).{0,50}[A-Z]{5}[0-9]{4}[A-Z]{1}"
          # JSON patterns
          - '"(aadhar|aadhaar|uid|pan)".{0,30}"?[2-9]{1}[0-9]{3}\\s?[0-9]{4}\\s?[0-9]{4}"?'
          - '"(pan.?card|pan.?number)".{0,30}"?[A-Z]{5}[0-9]{4}[A-Z]{1}"?'
        part: body
        condition: or

      # Response status matcher
      - type: status
        status:
          - 200
          - 201
          - 400
          - 403
          - 404
          - 500

    # Negative matchers to reduce false positives
    negative:
      - type: word
        words:
          - "example"
          - "sample"
          - "dummy"
          - "test data"
          - "placeholder"
          - "XXXXX"
          - "12345"
          - "00000"
        part: body
        condition: or
        case-insensitive: true

    extractors:
      # Extract all found identity documents
      - type: regex
        name: aadhar-with-spaces
        regex:
          - "[2-9]{1}[0-9]{3}\\s[0-9]{4}\\s[0-9]{4}"
        part: body
        internal: true

      - type: regex
        name: aadhar-without-spaces
        regex:
          - "[2-9]{1}[0-9]{11}"
        part: body
        internal: true

      - type: regex
        name: pan-cards
        regex:
          - "[A-Z]{5}[0-9]{4}[A-Z]{1}"
        part: body
        internal: true

      # Extract surrounding context for better analysis
      - type: regex
        name: context-aadhar
        regex:
          - ".{0,50}[2-9]{1}[0-9]{3}\\s?[0-9]{4}\\s?[0-9]{4}.{0,50}"
        part: body
        internal: true

      - type: regex
        name: context-pan
        regex:
          - ".{0,50}[A-Z]{5}[0-9]{4}[A-Z]{1}.{0,50}"
        part: body
        internal: true

      # Extract response type for analysis
      - type: kval
        name: content-type
        kval:
          - content_type
