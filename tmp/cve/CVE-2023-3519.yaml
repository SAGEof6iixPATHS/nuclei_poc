id: citrix-cve-2023-3519

info:
  name: CVE-2023-3519 Citrix Unauthenticated Remote Code Execution
  author: Dhiraj Mishra (@RandomDhiraj)
  severity: high
  description: |
    Checks target for CVE-2023-3519 vulnerability.
    Compares the "Last-Modified" header in the server response to known patched versions.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-3519
    - https://twitter.com/DTCERT/status/1682032701430452233
  date: 2023-07-07

requests:
  - method: GET
    path:
      - "{{BaseURL}}/"
    headers:
      Host: "{{Hostname}}"
    matchers:
      - type: word
        name: last_modified_header
        words:
          - "Fri, 07 Jul 2023 15:39:40 GMT"
          - "Mon, 10 Jul 2023 17:41:17 GMT"
          - "Mon, 10 Jul 2023 18:36:14 GMT"
        part: header
        name: last_modified
        condition: or
    matchers-condition: or
    extractors:
      - type: regex
        name: last_modified
        regex:
          - "Last-Modified: (.*)"
        group: 1
    validators:
      - type: status
        status:
          - 200
    payloads:
      - name: check_last_modified
        path: "{{BaseURL}}/"
        method: GET
        headers:
          Host: "{{Hostname}}"
        matchers:
          - type: word
            name: patched_version
            words:
              - "Fri, 07 Jul 2023 15:39:40 GMT"
              - "Mon, 10 Jul 2023 17:41:17 GMT"
              - "Mon, 10 Jul 2023 18:36:14 GMT"
            part: header
            condition: or
        extractors:
          - type: regex
            name: last_modified
            regex:
              - "Last-Modified: (.*)"
            group: 1
        validators:
          - type: status
            status:
              - 200

    extractors:
      - type: regex
        name: last_modified
        regex:
          - "Last-Modified: (.*)"
        group: 1

    matchers:
      - type: word
        name: result
        words:
          - "Fri, 07 Jul 2023 15:39:40 GMT"
          - "Mon, 10 Jul 2023 17:41:17 GMT"
          - "Mon, 10 Jul 2023 18:36:14 GMT"
        part: header
        condition: or
    extractors:
      - type: regex
        name: last_modified
        regex:
          - "Last-Modified: (.*)"
        group: 1

    matchers:
      - type: word
        name: result
        words:
          - "Fri, 07 Jul 2023 15:39:40 GMT"
          - "Mon, 10 Jul 2023 17:41:17 GMT"
          - "Mon, 10 Jul 2023 18:36:14 GMT"
        part: header
        condition: or
    extractors:
      - type: regex
        name: last_modified
        regex:
          - "Last-Modified: (.*)"
        group: 1

    matchers:
      - type: word
        name: result
        words:
          - "Fri, 07 Jul 2023 15:39:40 GMT"
          - "Mon, 10 Jul 2023 17:41:17 GMT"
          - "Mon, 10 Jul 2023 18:36:14 GMT"
        part: header
        condition: or
