id: nextjs-middleware-vuln-detection

info:
  name: "Next.js Middleware Bypass Vulnerability Detection"
  author: n0ur5
  severity: medium
  description: |
    This template detects potential Next.js middleware vulnerabilities where a 307
    redirect response leaks internal headers. The response must include a 307
    status and at least one of the headers: x-nextjs-redirect, x-middleware-rewrite,
    or x-nextjs-rewrite with a non-empty value.
  reference:
    - https://slcyber.io/assetnote-security-research-center/doing-the-due-diligence-analysing-the-next-js-middleware-bypass-cve-2025-29927/
    - https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware
    - https://nextjs.org/blog/cve-2025-29927
  tags: nextjs, middleware, cve-2025-29927

requests:
  - method: GET
    path:
      - "{{BaseURL}}/"
    headers:
      X-Nextjs-Data: "1"
      Accept-Encoding: "gzip, deflate, br"
      Accept: "*/*"
      Accept-Language: "en-US;q=0.9,en;q=0.8"
      User-Agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"
      Connection: "close"
      Cache-Control: "max-age=0"
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 307
      - type: regex
        part: header
        regex:
          - "(?i)(x-nextjs-redirect:\\s*\\S+|x-middleware-rewrite:\\s*\\S+|x-nextjs-rewrite:\\s*\\S+)"
